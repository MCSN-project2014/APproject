\chapter{\label{chapter4} The \fwap Interpreter}

The interpreter module is capable of running the \fwap intermediate representation (AST) and produce the correct results. The executable for this piece of software is contained within the release file \textit{funwapi.exe}. 

\section{\texttt{Environment.cs}}

Each instance of \texttt{Environment.cs} keeps track of the value of the variables in a given function (main included), during the execution of a program. It is then of fundamental importance for the interpreter to work. It is structured as a \texttt{List<Dictionary<string, object>>} because it must maintain the associations related to each single scope, i.e. when the code enters/exits a scope the a dictionary is added/removed from the list.

The method \texttt{addValue(Obj var, object value)} inserts a new variable (and the associated value) within the last opened scope; the method \texttt{updateValue(Obj var, object value)} search for the first variable with a given name in the 'nearest' scope and updates its value (according to the static scope rule). Also a method to get the value of a variable is provided.

\section{Interpreting \fwap}

The interpreter starts with the method \texttt{Start()} which stores the name of the declared functions and a pointer to them and calls the \texttt{Interpret(ASTNode n, Environment env)} over the main node (creating a new \texttt{Environment.cs}). 

While the \texttt{Interpret(ASTNode n, Environment env)} method is able to execute all the statements (\texttt{while}, \texttt{readln}...), the \texttt{InterpretExp(ASTNode n, Environment env)} is called to interpret any boolean or arithmetic expression. Recursive calls to both of them allow to follow the code flow and produce results.

A special case of interpretation 
